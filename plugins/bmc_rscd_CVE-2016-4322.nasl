#
# (C) Tenable Network Security, Inc.
#

include("compat.inc");

if (description)
{
  script_id(93686);
  script_version("$Revision: 1.4 $");
  script_cvs_date("$Date: 2016/11/11 20:08:42 $");

  script_cve_id("CVE-2016-4322");
  script_bugtraq_id(92736);
  script_osvdb_id(143803);
  script_xref(name:"IAVB", value:"2016-B-0138");

  script_name(english:"BMC Server Automation rscd Service Authentication Bypass RCE");
  script_summary(english:"Checks the version of BMC Server Automation.");

  script_set_attribute(attribute:"synopsis", value:
"The BMC Server Automation RSCD agent running on the remote host is
affected by a remote command execution vulnerability.");
  script_set_attribute(attribute:"description", value:
"According to its self-reported version number, the BMC Server
Automation (BSA) RSCD agent running on the remote host is affected by
a remote command execution vulnerability due to a logic flaw in the
authentication process of the rscd network daemon. An unauthenticated,
remote attacker can exploit this issue to execute certain privileged
commands without providing valid client certificates or credentials.
Specifically, one such command is REMOTE_COPY_DIRECTORY, which can
be used to retrieve all files on the system with root privileges.

Note that Nessus has not tested for this issue but has instead relied
only on the application's self-reported version number.");
  script_set_attribute(attribute:"see_also", value:"http://www.securityfocus.com/archive/1/539351");
  script_set_attribute(attribute:"solution", value:
"Upgrade to BSA version 8.8 or later. Alternatively, apply version 8.7
Patch 3.");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:C/I:N/A:N");
  script_set_cvss_temporal_vector("CVSS2#E:F/RL:OF/RC:ND");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:N/A:N");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:F/RL:O/RC:X");
  script_set_attribute(attribute:"exploitability_ease", value:"Exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"true");

  script_set_attribute(attribute:"vuln_publication_date", value:"2016/09/05");
  script_set_attribute(attribute:"patch_publication_date", value:"2016/06/05");
  script_set_attribute(attribute:"plugin_publication_date", value:"2016/09/23");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/a:bmc:bladelogic_server_automation_rscd_agent");
  script_set_attribute(attribute:"stig_severity", value:"I");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Misc.");

  script_copyright(english:"This script is Copyright (C) 2016 Tenable Network Security, Inc.");

  script_dependencies("bmc_rscd_detect.nbin");
  script_require_ports(4750,"Services/bladelogic_rscd");

  exit(0);
}

include("audit.inc");
include("global_settings.inc");
include("misc_func.inc");

app = "Bladelogic rscd";
appname = 'bladelogic_rscd';
port = get_service(svc:appname, default:4750, exit_on_fail:TRUE);

if (!isnull(port))
  version = get_kb_item("Services/www/" + port + "/version");

if (isnull(version))
  audit(AUDIT_UNKNOWN_APP_VER, app);
if (version !~ "^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$")
  audit(AUDIT_VER_NOT_GRANULAR, app, port, version);

if (ver_compare(fix:'8.7.0.3', ver:version) < 0)
{
  report =
    '\n  Installed version : ' + version +
    '\n  Fixed version     : Apply 8.7 Patch 3 or upgrade to 8.8 or later.';
  security_report_v4(port:port, severity:SECURITY_HOLE, extra:report);
}
else audit(AUDIT_INST_VER_NOT_VULN, app, version);
