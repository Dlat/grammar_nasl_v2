#TRUSTED 7fc77583368ea476af658e546fcacac71d01a403352a2df8271aae28aab8cc3728173b3a769851b00f94f655aa88d5e3a4d1911938d5cc525ea0a65b5b918f58df648e35d3f12322d0a8a7d7c43299ea1ed2e8b74748765521a38f36f53c70e32d0c0aff91dd0b7b0da3e87444bd0727ebda5493fa9233a7c566c9d761434256f33597f126833067701b83e230a8c601c4f3be3526816b53d3e1067d717b17f565a64459b0b8d413e9d5b2e8022107c821f58ba260e5aa9d6d05022ccc4d318a747d6375852ce0941118e142accd8feb60c2a104114acb3be44d8f5acdad4d159487bc93c5c153940f2d09302f5bd610cb38cc97c8cd0cf91ff112187742c26a7b8480c876649ea0c8d1b10dd5c0ae9282058d24694a7f222a36a98444a5a3e354f627d7f0511e6ac32f73c243adb3706cb51cd0b40e0313b82eb93068de4c06461df45acf63a7e7dff5c8f5764682dfcb0097c4f8a14993b49d6f67d2eec2a1d6bd5b2f99f810c743a5741f9ca94ecc33b38691ca21c1424830bbc38fb8ecfb45d6193c94027d3af4284d44172788645d477c30bf2944380cbfdf834ae887aba0ce7ef07eb4fc510d28570a9d61d50918c02dee56d97e72f0aeb34053bb094ccacbf042d287e4dfee4ac9f00c8148ded654aab2a96a14c652828d91b4417c820fb04f8fb36c5b0581b13625a7848c5f8d6c99df0552cc996ef5d65c17cce658
#
# (C) Tenable Network Security, Inc.
#

include("compat.inc");

if (description)
{
  script_id(79625);
  script_version("1.1");
  script_set_attribute(attribute:"plugin_modification_date", value:"2014/11/28");

  script_cve_id("CVE-2014-3376");
  script_bugtraq_id(69956);
  script_osvdb_id(111746);
  script_xref(name:"CISCO-BUG-ID", value:"CSCuq12031");

  script_name(english:"Cisco IOS XR Malformed RSVP Packet DoS");
  script_summary(english:"Checks the IOS XR version.");

  script_set_attribute(attribute:"synopsis", value:"The remote device is missing a vendor-supplied security patch.");
  script_set_attribute(attribute:"description", value:
"The remote Cisco device is running a version of IOS XR software that
is affected by a denial of service vulnerability related to the
improper parsing of malformed RSVP packets.");
  # http://tools.cisco.com/security/center/viewAlert.x?alertId=35773
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?6a0bdbd7");
  # http://tools.cisco.com/security/center/content/CiscoSecurityNotice/CVE-2014-3376
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?7451aa56");
  script_set_attribute(attribute:"solution", value:"Apply the relevant patch referenced in Cisco bug ID CSCuq12031.");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:N/I:N/A:P");
  script_set_cvss_temporal_vector("CVSS2#E:ND/RL:OF/RC:C");
  script_set_attribute(attribute:"exploitability_ease", value:"Exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"true");

  script_set_attribute(attribute:"vuln_publication_date", value:"2014/09/18");
  script_set_attribute(attribute:"patch_publication_date", value:"2014/09/18");
  script_set_attribute(attribute:"plugin_publication_date", value:"2014/11/28");

  script_set_attribute(attribute:"plugin_type", value:"local");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:cisco:ios_xr");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_copyright(english:"This script is (C) 2014 Tenable Network Security, Inc.");
  script_family(english:"CISCO");

  script_dependencies("cisco_ios_xr_version.nasl");
  script_require_keys("Host/Cisco/IOS-XR/Version");

  exit(0);
}

include("audit.inc");
include("cisco_func.inc");
include("cisco_kb_cmd_func.inc");

version  = get_kb_item_or_exit("Host/Cisco/IOS-XR/Version");

flag     = FALSE;
override = FALSE;

if (version =~ "^5\.0\.")
  flag = TRUE;
else if (version =~ "^5\.1\.4" && ver_compare(ver:version, fix:"5.1.4.1" , strict:FALSE) < 0)
  flag = TRUE;
else if (version =~ "^5\.1\."  && ver_compare(ver:version, fix:"5.1.3.19", strict:FALSE) < 0)
  flag = TRUE;
else if (version =~ "^5\.2\."  && ver_compare(ver:version, fix:"5.2.1.29", strict:FALSE) < 0)
  flag = TRUE;

if (!flag) audit(AUDIT_INST_VER_NOT_VULN, 'Cisco IOS XR', version);

if (!isnull(get_kb_item("Host/local_checks_enabled")))
{
  buf = cisco_command_kb_item("Host/Cisco/Config/show_rsvp_interface_detail", "show rsvp interface detail");
  # Check for basic RSVP config
  if (check_cisco_result(buf))
  {
      if ("INTERFACE:" >!< buf || "BW (bits/sec):" >!< buf) audit(AUDIT_HOST_NOT, "affected because RSVP is not enabled.");
  }
  else if (cisco_needs_enable(buf)) override = TRUE;
}

if (report_verbosity > 0)
{
  report =
    '\n  Cisco bug IDs     : CSCuq12031' +
    '\n  Installed release : ' + version +
    '\n';
  security_warning(port:0, extra:report+cisco_caveat(override));
}
else security_warning(port:0, extra:cisco_caveat(override));
