#TRUSTED afdda8962660642bba95d8ea929cf4fc08da89fae82a093989ba09ffa2aecbc70067aedca05c6197d3ebdabd170078d99f52051d2f7cadc67a700d56c0c4e6351f56ac1ea6e645362d7e4491dca9110c2cde912a5dc8b8eabe896fc3991db681f7c106042cfb483b2f507e2c4e0a622b3b336486ee8a29e301688e92961ebafe81a2b90f25b8b2960382fb18ff892d2165ef67c6bdb5537748d40fcfa18110bc636378344520c5525e0430de288a2ee64767c39f9f4fbdf715ec8ab76a09281fb8551755e6ff35a2942334cd11f6f3986caa7edb939bed2140c7854324c0bb6da435b9e6c19447aa42bd68dcba753b564c7c593651a0a5a3a4230ef6ed5e26f54cec7a43066b7283c74c66ebc5d6b1aefd72ca04c5e8aedd67d2ca0a26c99d5aa8130b8f568187f24f13241189ef18decbee464e98fde1cda69d3b221bba21a5bf9071cd4374088e7e953ed18e54eba5403e6b43f9de07d3d0230029075d5f05b00c1de3191ea79cff3d14fdd531102ad55286d3bae35d8f8053191217038c577212a6fc6ad17796dce3e004abef1084a8f35200fd7cb14bb86f388cc3e153bd810a03c79b47f968ba9349927aa25c12c847295ea31de4dfbe92b28a79fe1316e4915b2cb634179abc55a112b16eebec9d173b6888117b173a8695fe60dc42c5d0fbe797792ff609e7b38c70c6e77fc37c436479a5469fafcfc5aca9a7b12553
#
# (C) Tenable Network Security, Inc.
#

include("compat.inc");

if (description)
{
  script_id(83782);
  script_version("1.3");
  script_set_attribute(attribute:"plugin_modification_date", value:"2017/05/16");

  script_cve_id("CVE-2015-0669");
  script_bugtraq_id(73245);
  script_osvdb_id(119790);
  script_xref(name:"CISCO-BUG-ID", value:"CSCup62167");

  script_name(english:"Cisco ANI Configuration Overwrite DoS (CSCup62167)");
  script_summary(english:"Checks the IOS version.");

  script_set_attribute(attribute:"synopsis", value:
"The remote device is affected by an denial of service vulnerability.");
  script_set_attribute(attribute:"description", value:
"The remote Cisco device is affected by a vulnerability in the
Autonomic Networking Infrastructure (ANI) due to insufficient
validation of received Autonomic Networking (AN) messages. A remote,
unauthenticated attacker, by sending specially crafted AN messages,
can exploit this to overwrite configuration settings, resulting in a
denial of service condition in a limited set of router services.");
  script_set_attribute(attribute:"see_also", value:"https://tools.cisco.com/security/center/viewAlert.x?alertId=37935");
  script_set_attribute(attribute:"solution", value:
"Upgrade to the relevant fixed version referenced in Cisco bug ID
CSCup62167.");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:N/I:P/A:P");

  script_set_attribute(attribute:"vuln_publication_date", value:"2015/03/19");
  script_set_attribute(attribute:"patch_publication_date", value:"2015/03/19");
  script_set_attribute(attribute:"plugin_publication_date", value:"2015/05/22");

  script_set_attribute(attribute:"plugin_type", value:"local");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:cisco:ios");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"CISCO");

  script_copyright(english:"This script is Copyright (C) 2015-2017 Tenable Network Security, Inc.");

  script_dependencies("cisco_ios_version.nasl");
  script_require_keys("Host/Cisco/IOS/Version");

  exit(0);
}

include("audit.inc");
include("cisco_func.inc");
include("cisco_kb_cmd_func.inc");

flag = 0;
override = 0;

# According to CSCug65204, the following releases are affected :
# 15.4S 15.4(3)S 15.4(2.17)S0.7
version = get_kb_item_or_exit("Host/Cisco/IOS/Version");
if (
  version == '15.4S' ||
  version == '15.4(3)S' ||
  version == '15.4(2.17)S0.7'
) flag++;

# Check that ANI is running
if (flag && get_kb_item("Host/local_checks_enabled"))
{
  flag = 0;
  buf = cisco_command_kb_item("Host/Cisco/Config/show_run_autonomic","show run | include autonomic");
  if (check_cisco_result(buf))
  {
    if (
      ( !empty_or_null(buf) ) &&
      ( "no autonomic" >!< buf )
    ) flag = 1;
  }
  else if (cisco_needs_enable(buf))
  {
    flag = 1;
    override = 1;
  }
}

if (flag)
{
  if (report_verbosity > 0)
  {
    report =
    '\n  Cisco bug ID      : CSCup62167' +
    '\n  Installed release : ' + version +
    '\n';
    security_warning(port:0, extra:report + cisco_caveat(override));
  }
  else security_warning(port:0, extra:cisco_caveat(override));
  exit(0);
}
else audit(AUDIT_HOST_NOT, "affected");
