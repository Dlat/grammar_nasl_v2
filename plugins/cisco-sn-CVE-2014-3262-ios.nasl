#TRUSTED 2fef92ad2dd319de6d2fcb541598b122b62cb5d047234afb3d8c10b5b03f753364e77915b55d3a5a4e4c93179abed91934f9ff7babecc388faf5fa4af0708a2e5f8c177c5b4f114283a7ceb4aaa7e32671da05707127efd4eb10e94bfb2c6a6ccff8db665dd6e0556bf990d0c7f3d130730d1a9b6b46525803e1d603879bc7bfd018bcc9b2cab5f667d3242b12620f72e09a8409923f72ad75e2165bb3415163c1740a0e8a8b082988f48c37a5aa56c465e0b6d976536613c3386fc62827a8e9bd2ea52bf3e30c996bf52cb90cef7743429e39320dac4a9b975d80a234cc0ca9b203a0317c7e2bd76fbbe95cccc60a8484cdaa04f8ae95317762ce8a1fb8c0da222fdffc739bcea05bd441aedc9dd34043cb36e56aa2d8375d13109b0df34f96a4b590f11b1ceeb0aac3cf294507dc77f112288fcbaba877bc59d03c153240f8916128c20ddf7bfc434b642203de6051083fc0fd3011114c68e764adf37344f8e6e9e95ff9ef581e880b5550be1b5280f9c09747de59f9e26fd5eb70548f4b6972af2fbcf116b1e5576c71dbb67d6b9d0fea587a54ac897d56f11b3c211aa04e338d7b6fa5d349159f605a6d6b9f4b4730c1f9aad5cc9d529e9bc9ed8c150bf6dee75989313c6cc45de6ffaadd6fb69b9deefbd49d0cbf0bb8a38afe725f35190d35fc775e2b8c1afb78181fcab419ae963bffe11c642f66622bd0c07f2abab8
#
# (C) Tenable Network Security, Inc.
#

include("compat.inc");

if (description)
{
  script_id(79249);
  script_version("1.3");
  script_set_attribute(attribute:"plugin_modification_date", value:"2017/05/16");

  script_cve_id("CVE-2014-3262");
  script_bugtraq_id(67399);
  script_osvdb_id(106936);
  script_xref(name:"CISCO-BUG-ID", value:"CSCun73782");

  script_name(english:"Cisco IOS LISP ITR DoS (CSCun73782)");
  script_summary(english:"Checks the IOS version.");

  script_set_attribute(attribute:"synopsis", value:"The remote device is running a vulnerable IOS version.");
  script_set_attribute(attribute:"description", value:
"The remote Cisco device is potentially affected by an issue related to
the handling of certain parameters in Locator/ID Separation Protocol
(LISP) control messages sent to the ingress tunnel router (ITR)
component. A remote, unauthenticated attacker could exploit this issue
by sending specially crafted LISP control messages to cause a denial
of service.");
  # http://tools.cisco.com/security/center/content/CiscoSecurityNotice/CVE-2014-3262
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?3a78aa54");
  script_set_attribute(attribute:"see_also", value:"https://tools.cisco.com/security/center/viewAlert.x?alertId=34233");
  script_set_attribute(attribute:"solution", value:
  "Upgrade to the relevant fixed version referenced in Cisco bug ID
  CSCun73782.");
  script_set_cvss_base_vector("CVSS2#AV:A/AC:M/Au:N/C:N/I:N/A:P");
  script_set_cvss_temporal_vector("CVSS2#E:ND/RL:OF/RC:C");
  script_set_attribute(attribute:"exploitability_ease", value:"Exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"true");

  script_set_attribute(attribute:"plugin_type", value:"local");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:cisco:ios");

  script_set_attribute(attribute:"vuln_publication_date", value:"2014/05/14");
  script_set_attribute(attribute:"patch_publication_date", value:"2014/05/30");
  script_set_attribute(attribute:"plugin_publication_date", value:"2014/11/14");

  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_copyright(english:"This script is Copyright (C) 2014-2017 Tenable Network Security, Inc.");
  script_family(english:"CISCO");

  script_dependencies("cisco_ios_version.nasl");
  script_require_keys("Host/Cisco/IOS/Version");
  script_require_ports("Host/Cisco/IOS/Model", "CISCO/model");

  exit(0);
}

include("audit.inc");
include("cisco_func.inc");
include("cisco_kb_cmd_func.inc");

# check model
model = get_kb_item("CISCO/model");
if (isnull(model)) model = get_kb_item_or_exit("Host/Cisco/IOS/Model");
if (model !~ "(^|[^0-9]+)(8|9|18|19|28|29|38|39|72)[0-9][0-9]($|[^0-9])") audit(AUDIT_HOST_NOT, "affected");

version = get_kb_item_or_exit("Host/Cisco/IOS/Version");

if (
  version == "15.3(3)XB12" ||
  version == "15.2(4)XB9"  ||
  version =~ "^15\.3\(3\)[MS]($|[01]($|[^0-9]))"  ||
  version =~ "^15\.3\(3\)M2($|\.[0-3]($|[^0-9]))" ||
  version =~ "^15\.3\(3\)S2($|\.[0-7]($|[^0-9]))" ||
  version =~ "^15\.4\([12]\)S($|0($|[^0-9]))" ||
  version =~ "^15\.4\(1\)S1($|\.[0-2]($|[^0-9]))" ||
  version =~ "^15\.4\(2\)S0($|\.[0-2]($|[^0-9]))"
)
{
  flag     = FALSE;
  override = FALSE;

  if (get_kb_item("Host/local_checks_enabled"))
  {
    buf = cisco_command_kb_item("Host/Cisco/Config/show_running-config", "show running-config");
    if (check_cisco_result(buf))
    {
      if (preg(multiline:TRUE, pattern:"^\s+ipv[46]\sitr(\s|$)", string:buf))
        flag = TRUE;
    }
    else if (cisco_needs_enable(buf)) override = TRUE;
  }

  if (!flag && !override) audit(AUDIT_HOST_NOT, "affected");

  if (report_verbosity > 0)
  {
    report =
      '\n  Cisco Bug ID        : CSCun73782' +
      '\n    Installed release : ' + version + 
      '\n';

    security_note(port:0, extra:report+cisco_caveat(override));
    exit(0);
  }
  else security_note(port:0, extra:cisco_caveat(override));
}
else audit(AUDIT_INST_VER_NOT_VULN, "Cisco IOS software", version);
