#TRUSTED 790dac17bd5993569b6f533ff2bd437936460868a52231f7327aaea65126ae7405303d6c668991340f502dc26e0fb81d81c91810e257e4488c63de9e0b4da2c784dea546306d003067888324a3e84c4cbe579440767d9e86a90413de2f27292c1c35b9c24769d4f468e62c8ced2ef4295b7a376187307b0b761bc57401a7bc109aabaf5819622144cb5549adcd60ca9527e7965937a44d01e547624d6d0843676faa7d54d4a25a04e37b2fb5b6cfc1aad346960ae7fb1b9129707d21989875dca5b2cbfb64f56a7f36a484c66ea8a254e6c63c18fefa10e0a8f79797b1eb575c4a72ab786828a0209adac501144c2dc6798ffd0cffaae057bdab4e7dcc322b733f15a7efc340f9016fc981c9a063839880e24e4d831cc38e52d50331c8ecf1d8a3c79d39fcd181e64c5ba5305e480fc2a5ff37a0a6831944eb5f205df760d7837806d37d77e0d478075948239d1c97fb6021a115c5d798450157253d22b79133f2219616a33320805316da6287cdcf1fc4748258e925213cda0ee95f61884e6497468ea89256f42a007e7d7c6983699303aff476eafafc6432d8a360c7832c39796a3bfcd48ce76ee58e2b56c227814255e452dedf961789b8a2b1b994fa466d9d0aaa4b66ca0a2c9f50c23eaa7a0c1c1abc7b3513a5eec030b34c3598e0b88d57249f493cb566409ab351f2f04dd9f3fff1729869e3d46bd153779c6d6f0d7a
#
# (C) Tenable Network Security, Inc.
#

include("compat.inc");

if (description)
{
  script_id(73829);
  script_version("1.6");
  script_set_attribute(attribute:"plugin_modification_date", value:"2017/05/17");

  script_cve_id("CVE-2014-2131");
  script_bugtraq_id(66515);
  script_osvdb_id(105076);
  script_xref(name:"CISCO-BUG-ID", value:"CSCug41049");
  script_xref(name:"CISCO-BUG-ID", value:"CSCue61890");

  script_name(english:"Cisco IOS XE VSS / BDF Traffic DoS (CSCug41049 / CSCue61890)");
  script_summary(english:"Checks the IOS XE version.");

  script_set_attribute(attribute:"synopsis", value:
"The remote device is affected by a denial of service vulnerability.");
  script_set_attribute(attribute:"description", value:
"The remote Cisco device is affected by a denial of service
vulnerability in its packet driver code when handling Virtual
Switching Systems (VSS) or Bidirectional Forwarding Detection (BFD)
traffic. An unauthenticated, adjacent attacker can exploit this to
cause a device reload.

Note that this issue only affects Cisco Catalyst 4000 Series switches.");
  script_set_attribute(attribute:"see_also", value:"https://tools.cisco.com/security/center/viewAlert.x?alertId=33558");
  script_set_attribute(attribute:"solution", value:
"Upgrade to the relevant fixed version referenced in Cisco bug IDs
CSCug41049 and CSCue61890.");
  script_set_cvss_base_vector("CVSS2#AV:A/AC:L/Au:N/C:N/I:N/A:C");
  script_set_cvss_temporal_vector("CVSS2#E:ND/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:A/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H");
  script_set_attribute(attribute:"exploitability_ease", value:"Exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"true");

  script_set_attribute(attribute:"vuln_publication_date", value:"2014/03/28");
  script_set_attribute(attribute:"patch_publication_date", value:"2014/03/28");
  script_set_attribute(attribute:"plugin_publication_date", value:"2014/05/02");

  script_set_attribute(attribute:"plugin_type", value:"local");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:cisco:ios_xe");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"CISCO");

  script_copyright(english:"This script is Copyright (C) 2014-2017 Tenable Network Security, Inc.");

  script_dependencies("cisco_ios_xe_version.nasl");
  script_require_keys("Host/Cisco/IOS-XE/Version");

  exit(0);
}

include("audit.inc");
include("cisco_func.inc");
include("cisco_kb_cmd_func.inc");

version = get_kb_item_or_exit("Host/Cisco/IOS-XE/Version");
flag=0;

model = get_kb_item_or_exit("Host/Cisco/IOS-XE/Model");
if (model !~ "Catalyst 4[0-9][0-9][0-9]($|[^0-9])") audit(AUDIT_HOST_NOT, "affected");

if (version == '3.0.2.1') flag++;

override = FALSE;

cmds = make_list();
if (get_kb_item("Host/local_checks_enabled") && flag)
{
  flag = 0;
  # Look for BFD
  buf = cisco_command_kb_item("Host/Cisco/Config/show_running-config", "show running-config");
  if (check_cisco_result(buf))
  {
    if (preg(string:buf, pattern:"bfd\s+interval\s+\d+\s+min_rx\s+\d+\s+multiplier\s+\d", multiline:TRUE)) 
    { 
      flag = 1;
      cmds = make_list('show running-config');
    }
  }
  else if (cisco_needs_enable(buf)) { flag = 1; override = TRUE; }

  # Look for VSS
  buf = cisco_command_kb_item("Host/Cisco/Config/show_mod", "show mod");
  if (check_cisco_result(buf))
  {
    if (preg(string:buf, pattern:"Switch Number:\s+\d+\s+Role:\s+Virtual Switch Active", multiline:TRUE)) 
    { 
      flag = 1; 
      override = FALSE; 
      cmds = make_list(cmds, 'show mod');
    }
  }
  else if (cisco_needs_enable(buf)) { flag = 1; override = TRUE; }

  if (!flag && !override) audit(AUDIT_OS_CONF_NOT_VULN, "Cisco IOS XE", version);
}

if (flag || override)
{

  security_report_cisco(
    port     : 0,
    severity : SECURITY_WARNING,
    override : override,
    version  : version,
    bug_id   : "CSCug41049, CSCue61890",
    cmds     : cmds
  );
  
}
else audit(AUDIT_HOST_NOT, "affected");
